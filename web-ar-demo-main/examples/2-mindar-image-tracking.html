<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/2-mindar-image-tracking.css">
    <script src="../js/aframe-v1.4.2.min.js"></script>
    <script src="../js/aframe-extras.min.js"></script>
    <title>asdf</title>
    <script>
        const debug = (str) => {
            document.querySelector('.debug').innerHTML = str
        }

        AFRAME.registerComponent('change-color-on-hover', {
            schema: {
                color: { default: 'red' }
            },

            init: function () {
                var data = this.data;
                var el = this.el;  // <a-box>
                var defaultColor = el.getAttribute('material').color;

                el.addEventListener('mouseenter', function (ev) {
                    console.log(ev)
                    el.setAttribute('color', data.color);
                });

                el.addEventListener('mouseleave', function () {
                    el.setAttribute('color', defaultColor);
                });
            }
        });

        AFRAME.registerComponent('on-hover', {
            schema: {
                color: { default: 'red' }
            },

            init: function () {
                var data = this.data;
                var el = this.el;
                var activeZone = null
                el.addEventListener('mouseenter', function (ev) {
                    // console.log(ev.detail.intersection.object)
                    if (activeZone){
                        activeZone.scale.x = 
                        activeZone.scale.y = 
                        activeZone.scale.z = 1
                    }

                    activeZone = ev.detail.intersection.object
                    activeZone.scale.x = 
                    activeZone.scale.y = 
                    activeZone.scale.z = 1.3
                    

                    debug(activeZone.name)
                });

                el.addEventListener('mouseleave', function (ev) {
                    if (activeZone){
                        activeZone.scale.x = 
                        activeZone.scale.y = 
                        activeZone.scale.z = 1
                    }
                })

                el.addEventListener('click', function (ev) {
                    activeZone = ev.detail.intersection.object
                    activeZone.scale.x = 
                    activeZone.scale.y = 
                    activeZone.scale.z = 1.3
                });
            }
        });
    </script>

<body>
    <div class="debug">print out</div>
    <a-scene scene-controller  renderer="logarithmicDepthBuffer: true; colorManagement: true;"
        arjs="detectionMode: mono_and_matrix; matrixCodeType: 4x4_BCH_13_9_3;"
        gltf-model="dracoDecoderPath: ../js/decoders/; basisTranscoderPath: ../js/decoders/; meshoptDecoderPath: ../js/decoders/meshopt_decoder.js;">

        <a-assets>
            <a-asset-item id="buddha" src="../assets/models/buddha/scene.gltf"></a-asset-item>
        </a-assets>

        <a-entity visible="true" 
            data-list-id="1" 
            gltf-model="#buddha" 
            position="-1.5 1 -3" 
            scale="0.1 0.1 0.1" 
            rotation="0 0 0"
            on-hover="color: blue;"
            laser-controls raycaster="far: 2">
        </a-entity>

        <a-box color="#EF2D5E" position="0 1 4" change-color-on-hover="color: blue"></a-box>

        <a-camera>
            <a-cursor></a-cursor>
        </a-camera>
    </a-scene>
</body>

</html>